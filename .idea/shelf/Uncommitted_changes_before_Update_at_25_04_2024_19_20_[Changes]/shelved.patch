Index: rab.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from telebot import *\r\nimport pytube\r\nimport os\r\nimport requests\r\nimport re\r\nfrom moviepy.editor import *\r\n\r\nbot = telebot.TeleBot('6273204407:AAHc-578ru2Uie1JQnypi7YjdXL3fUU2-ew')\r\n\r\n\r\n@bot.message_handler(commands=['start'])\r\ndef start(message):\r\n    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n    btn1 = types.KeyboardButton(\"Дополнительные Данные\")\r\n    btn2 = types.KeyboardButton(\"Конвертор видео\")\r\n    btn3 = types.KeyboardButton(\"Скачивание видео со сторонних ресурсов\")\r\n    btn4 = types.KeyboardButton(\"Скачивание фото и документов со сторонних ресурсов\")\r\n    markup.add(btn1, btn2, btn3, btn4)\r\n\r\n    bot.send_message(message.chat.id, f\"Привет {message.from_user.username}! Я бот. Вот мои функции\",\r\n                     reply_markup=markup)\r\n\r\nyoutube = False\r\ntiktok = False\r\nfail = False\r\nkonvertorr_AVI = False\r\nkonvertorr_MPEG = False\r\nkonvertorr_MP3 = False\r\n\r\n\r\n@bot.message_handler(content_types=['text'])\r\ndef choose(message):\r\n    global youtube, tiktok, fail, konvertorr_AVI, konvertorr_MPEG, konvertorr_MP3\r\n    if message.text == 'Дополнительные Данные':\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('Сколько времени')\r\n        btn2 = types.KeyboardButton('Цель проекта')\r\n        btn3 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1, btn2, btn3)\r\n\r\n        bot.send_message(message.chat.id, text=\"Выберите опцию\", reply_markup=markup)\r\n\r\n    elif message.text == 'Сколько времени':\r\n        current_time = datetime.now().strftime('%H:%M:%S')\r\n        bot.send_message(message.chat.id, current_time)\r\n\r\n    elif message.text == 'Цель проекта':\r\n        bot.send_message(message.chat.id, text='''Проект представляет из себя бота, который даёт пользователю возможности:\r\n        1. Скачивание видео со сторонних ресурсов (YouTube, TikTok, Pinterest);\r\n        2. Конвертация видео в любые форматы;\r\n        3. Скачивание любых других данных со сторонних ресурсов (фото, документы и т.д.).\r\n                                            ''')\r\n\r\n    elif message.text == 'Скачивание видео со сторонних ресурсов':\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('YouTube')\r\n        btn2 = types.KeyboardButton('TikTok')\r\n        btn3 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1, btn2, btn3)\r\n        bot.send_message(message.chat.id, text=\"Выберите опцию\", reply_markup=markup)\r\n\r\n    elif message.text == 'YouTube':\r\n        youtube = True\r\n        tiktok = False\r\n        bot.send_message(message.chat.id, text=\"пришлите пожалуйста ссылку в формате \"\r\n                                               \"https://www.youtube.com/watch...\",\r\n                         reply_markup=types.ReplyKeyboardRemove())\r\n    elif message.text == 'TikTok':\r\n        tiktok = True\r\n        youtube = False\r\n        bot.send_message(message.chat.id, text=\"пришлите пожалуйста ссылку в формате \"\r\n                                               \"https://www.tiktok.com/\",\r\n                         reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif youtube:\r\n        downld_youtube(message)\r\n\r\n    elif tiktok:\r\n        downld_tiktok(message)\r\n\r\n    elif fail:\r\n        down_fail(message)\r\n\r\n    elif message.text == 'Скачивание фото и документов со сторонних ресурсов':\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('Скачивание фото')\r\n        btn2 = types.KeyboardButton('Скачивание документов')\r\n        btn3 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1, btn2, btn3)\r\n        bot.send_message(message.chat.id, text=\"Выберите опцию\", reply_markup=markup)\r\n\r\n    elif message.text == 'Скачивание фото':\r\n        fail = True\r\n        bot.send_message(message.chat.id, text=\"Введите ссылку на файл для скачивания: \",\r\n                         reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif message.text == 'Скачивание документов':\r\n        fail = True\r\n        bot.send_message(message.chat.id, text=\"Введите ссылку на файл для скачивания: \",\r\n                         reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif message.text == 'Конвертор видео':\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        markup.add('MP3', 'AVI', 'MOV')\r\n        bot.send_message(message.chat.id, text=\"Выберите формат в который хотите конвертировать видео\",\r\n                         reply_markup=markup)\r\n    elif message.text == 'MP3':\r\n        konvertorr_MP3 = True\r\n        bot.send_message(message.chat.id, text=\"Пришлите видео\", reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif message.text == 'AVI':\r\n        konvertorr_AVI = True\r\n        bot.send_message(message.chat.id, text=\"Пришлите видео\", reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif message.text == 'MPEG':\r\n        konvertorr_MPEG = True\r\n        bot.send_message(message.chat.id, text=\"Пришлите видео\", reply_markup=types.ReplyKeyboardRemove())\r\n\r\n    elif konvertorr_MP3:\r\n        konvertorrMP(message)\r\n\r\n    elif konvertorr_AVI:\r\n        konvertorr_AV(message)\r\n\r\n    elif message.text == 'Вернуться':\r\n        start(message)\r\n\r\n\r\n@bot.message_handler(content_types=['text'])\r\ndef downld_youtube(message):\r\n    ytlink = message.text\r\n    if str(ytlink).startswith('https://www.youtube.com/watch'):\r\n        bot.send_message(message.chat.id, 'видео загружается, подождите пожалуйста...')\r\n        try:\r\n            youtubelink = pytube.YouTube(ytlink)\r\n            video = youtubelink.streams.get_highest_resolution()\r\n            if os.path.exists('res.mp4'):\r\n                os.remove('res.mp4')\r\n            out_file = video.download(filename='res')\r\n            base, ext = os.path.splitext(out_file)\r\n            new_file = base + '.mp4'\r\n            os.rename(out_file, new_file)\r\n            vd = open('res.mp4', 'rb')\r\n            bot.send_video(message.chat.id, vd)\r\n            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n            btn1 = types.KeyboardButton(\"Вернуться\")\r\n            markup.add(btn1)\r\n            bot.send_message(message.chat.id, 'видео успешно загружено!', reply_markup=markup)\r\n        except Exception:\r\n            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n            btn1 = types.KeyboardButton(\"Вернуться\")\r\n            markup.add(btn1)\r\n            bot.send_message(message.chat.id, 'ошибка при загрузке видео, попробуйте еще раз', reply_markup=markup)\r\n    else:\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton(\"Вернуться\")\r\n        markup.add(btn1)\r\n        if message.text == 'Вернуться':\r\n            start(message)\r\n\r\n\r\ndef get_tiktok_video_id(url):\r\n    match = re.search(r'/video/(\\d+)', url)\r\n    if match:\r\n        return match.group(1)\r\n\r\n\r\n@bot.message_handler(content_types=['text'])\r\ndef downld_tiktok(message):\r\n    if str(message.text).startswith('https://www.tiktok.com/'):\r\n        if os.path.exists('tiktok.mp4'):\r\n            os.remove('tiktok.mp4')\r\n        response = requests.get(message.text)\r\n        video_id = get_tiktok_video_id(response.url)\r\n        response = requests.get(f'https://tikcdn.io/ssstik/{video_id}')\r\n\r\n        if response.status_code == 200:\r\n            with open(f\"tiktok.mp4\", \"wb\") as file:\r\n                file.write(response.content)\r\n            vd = open('tiktok.mp4', 'rb')\r\n            bot.send_video(message.chat.id, vd)\r\n            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n            btn1 = types.KeyboardButton(\"Вернуться\")\r\n            markup.add(btn1)\r\n            bot.send_message(message.chat.id, 'видео успешно загружено!', reply_markup=markup)\r\n        else:\r\n            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n            btn1 = types.KeyboardButton(\"Вернуться\")\r\n            markup.add(btn1)\r\n            bot.send_message(message.chat.id, 'ошибка при загрузке видео, попробуйте еще раз', reply_markup=markup)\r\n\r\n    elif message.text == 'Вернуться':\r\n        start(message)\r\n\r\n\r\ndef down_fail(message):\r\n    if message.text == 'Вернуться':\r\n        start(message)\r\n    else:\r\n        user_input = message.text\r\n        filename = user_input.split('/')[-1]\r\n        r = requests.get(user_input, allow_redirects=True)\r\n        open(filename, \"wb\").write(r.content)\r\n        bot.send_document(message.chat.id, open(filename, 'rb'))\r\n\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1)\r\n        bot.send_message(message.chat.id, text=\"Выберите действие\", reply_markup=markup)\r\n\r\n\r\n@bot.message_handler(content_types=['video'])\r\ndef konvertorrMP(message):\r\n    global konvertorr_MP3\r\n    konvertorr_MP3 = False\r\n    if message.text == 'Вернуться':\r\n        start(message)\r\n    else:\r\n        file_info = bot.get_file(message.video.file_id)\r\n        downloaded_file = bot.download_file(file_info.file_path)\r\n\r\n        with open('video.mp4', 'wb') as video_file:\r\n            video_file.write(downloaded_file)\r\n\r\n        video_clip = VideoFileClip('video.mp4')\r\n        audio_clip = video_clip.audio\r\n        audio_clip.write_audiofile(\"audio.mp3\")\r\n\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1)\r\n\r\n        audio_file = open(\"audio.mp3\", \"rb\")\r\n        bot.send_audio(message.chat.id, audio_file)\r\n\r\n        bot.send_message(message.chat.id, text=\"Выберите действие\", reply_markup=markup)\r\n\r\n        konvertorr_MP3 = False\r\n\r\n        return \"audio.mp3\"\r\n\r\n\r\n\r\n@bot.message_handler(content_types=['video'])\r\ndef konvertorr_AV(message):\r\n    global konvertorr_AVI\r\n    konvertorr_AVI = False\r\n    if message.text == 'Вернуться':\r\n        start(message)\r\n    else:\r\n        file_info = bot.get_file(message.video.file_id)\r\n        downloaded_file = bot.download_file(file_info.file_path)\r\n        with open('video.mp4', 'wb') as video:\r\n            video.write(downloaded_file)\r\n        clip = VideoFileClip(\"video.mp4\")\r\n        clip.write_videofile(\"video.avi\", codec='mpeg4', fps=144, bitrate='5000k')\r\n        with open(\"video.avi\", \"rb\") as video_file:\r\n            bot.send_video(message.chat.id, video_file)\r\n        os.remove(\"video.mp4\")\r\n        os.remove(\"video.avi\")\r\n        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)\r\n        btn1 = types.KeyboardButton('Вернуться')\r\n        markup.add(btn1)\r\n        bot.send_message(message.chat.id, text=\"Выберите действие\", reply_markup=markup)\r\n\r\n\r\n\r\n\r\nbot.polling()
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/rab.py b/rab.py
--- a/rab.py	(revision db25157dedd9daaeba888ed1620e421667038184)
+++ b/rab.py	(date 1714058266808)
@@ -240,7 +240,6 @@
         return "audio.mp3"
 
 
-
 @bot.message_handler(content_types=['video'])
 def konvertorr_AV(message):
     global konvertorr_AVI
@@ -264,6 +263,4 @@
         bot.send_message(message.chat.id, text="Выберите действие", reply_markup=markup)
 
 
-
-
 bot.polling()
\ No newline at end of file
